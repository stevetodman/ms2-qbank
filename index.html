<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MS2 Mini‚ÄëQBank ‚Äî Structural Congenital Heart Disease (40 items)</title>
  <meta name="theme-color" content="#0b0c10">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" href="icon-192.png" type="image/png">
  <style>
    :root{ --bg:#0b0c10; --card:#111218; --ink:#f5f7fa; --muted:#a9b0be; --accent:#66d9ef; --good:#3fb950; --bad:#f85149; --warn:#f2cc60; --chip:#21242e; --border:#1e2230; --focus:#6aa3ff; }
    [data-theme="light"]{ --bg:#f7f9fc; --card:#ffffff; --ink:#0b1220; --muted:#4a5568; --accent:#2563eb; --good:#15803d; --bad:#b91c1c; --warn:#b45309; --chip:#eef2f7; --border:#e2e8f0; --focus:#2563eb; }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; background:var(--bg); color:var(--ink); font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; }
    header{ position:sticky; top:0; z-index:5; backdrop-filter:saturate(1.2) blur(6px); background:linear-gradient(180deg,rgba(11,12,16,.85),rgba(11,12,16,.6)); border-bottom:1px solid var(--border); padding:12px 16px; display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
    [data-theme="light"] header{ background:linear-gradient(180deg,rgba(247,249,252,.92),rgba(247,249,252,.8)); }
    header h1{font-size:18px; margin:0; letter-spacing:.2px}
    header .pill{ background:var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px; color:var(--muted); font-size:13px; }
    .wrap{ display:grid; grid-template-columns:300px 1fr; gap:16px; padding:16px; max-width:1400px; margin:0 auto; }
    aside{ position:sticky; top:64px; align-self:start; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; }
    aside h2{ font-size:14px; margin:6px 0 6px; color:var(--muted); font-weight:600; text-transform:uppercase; letter-spacing:.7px }
    aside .group{ margin:10px 0 14px; display:flex; flex-direction:column; gap:8px }
    aside label{ display:flex; align-items:center; gap:8px; font-size:14px; color:var(--ink); cursor:pointer }
    aside input[type=checkbox], aside input[type=radio]{ accent-color:var(--focus) }
    aside .chips{ display:flex; gap:8px; flex-wrap:wrap; max-height:180px; overflow:auto; padding-right:4px }
    .chip{ background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:4px 10px; font-size:13px; color:var(--muted); cursor:pointer; user-select:none }
    .chip.active{ color:var(--ink); border-color:var(--focus) }
    .btn{ appearance:none; border:1px solid var(--border); background:#161821; color:var(--ink); padding:10px 12px; border-radius:10px; font-weight:600; cursor:pointer }
    [data-theme=light] .btn{ background:#f3f6fb } .btn:hover{ border-color:var(--focus) }
    .btn.primary{ background:#1c2230; border-color:#2a3650 } [data-theme=light] .btn.primary{ background:#e8eefc; border-color:#c7d2fe }
    .btn.good{ background:#0f2215; border-color:#0f3c17; color:#c7f5d2 }
    .btn.bad{ background:#2a0f12; border-color:#4a1117; color:#ffd3d3 }
    .btn.warn{ background:#2a2310; border-color:#5a4b1a; color:#ffecc0 }
    .btn.ghost{ background:transparent }
    .stack{ display:flex; gap:8px; flex-wrap:wrap }
    .question-card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px; min-height:300px }
    .question-meta{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:var(--muted); font-size:13px }
    .question-meta .flag{ cursor:pointer; padding:4px 8px; border-radius:6px; border:1px solid var(--border); background:var(--chip) }
    .question-stem{ font-size:18px; margin:10px 0 12px; white-space:pre-wrap }
    .options{ display:flex; flex-direction:column; gap:10px }
    .option{ display:flex; align-items:flex-start; gap:12px; padding:12px; border:1px solid var(--border); border-radius:10px; cursor:pointer; transition:background .15s ease, border-color .15s ease; background:#12131a }
    [data-theme=light] .option{ background:#f8fafc } .option:hover{ border-color:var(--focus) }
    .option .letter{ width:28px; height:28px; border-radius:50%; border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-weight:700; color:var(--muted); flex:0 0 28px }
    .option .text{ flex:1 } .option.selected{ border-color:#3a4a6d; background:#141a24 } [data-theme=light] .option.selected{ background:#eef2ff; border-color:#c7d2fe }
    .option.correct{ border-color:var(--good); background:#102115 } [data-theme=light] .option.correct{ background:#dcfce7; border-color:#86efac }
    .option.incorrect{ border-color:var(--bad); background:#221115 } [data-theme=light] .option.incorrect{ background:#fee2e2; border-color:#fecaca }
    .answer-strip{ display:flex; gap:10px; align-items:center; margin-top:12px }
    .explanation{ margin-top:14px; padding:12px; border:1px dashed var(--border); border-radius:10px; background:#10121a; color:#e8ecf7; display:none }
    [data-theme=light] .explanation{ background:#f1f5f9; color:#0b1220 } .explanation.show{ display:block }
    .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
    .tag{ font-size:12px; background:#141622; border:1px solid var(--border); color:var(--muted); border-radius:999px; padding:3px 8px }
    [data-theme=light] .tag{ background:#eef2f7; color:#384152 }
    footer{ max-width:1400px; margin:16px auto; color:var(--muted); font-size:12px; padding:0 16px 24px }
    .stat{ display:flex; gap:12px; flex-wrap:wrap } .kpi{ background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; min-width:150px }
    .progress{ height:8px; background:#141622; border:1px solid var(--border); border-radius:999px; overflow:hidden } [data-theme=light] .progress{ background:#eef2f7 }
    .progress > div{ height:100%; background:linear-gradient(90deg,#66d9ef,#7ee787) }
    .small{ font-size:12px; color:var(--muted) }
    .toolbar{ display:flex; align-items:center; gap:8px; flex-wrap:wrap }
    .search{ display:flex; align-items:center; gap:8px; background:#11131a; border:1px solid var(--border); border-radius:10px; padding:8px 10px } [data-theme=light] .search{ background:#fff }
    .search input{ background:transparent; border:0; outline:0; color:var(--ink); width:200px }
    .search .clear{ border:0; background:transparent; cursor:pointer; font-weight:700; color:var(--muted) }
    .hidden{ display:none }
    .visually-hidden{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0 }
    .btn:focus-visible, .option:focus-visible, .chip:focus-visible, .flag:focus-visible, input[type=radio]:focus-visible{ outline:2px solid var(--focus); outline-offset:2px }
    #toast{ position:fixed; bottom:16px; right:16px; background:var(--card); color:var(--ink); border:1px solid var(--border); padding:10px 12px; border-radius:8px; box-shadow:0 4px 14px rgba(0,0,0,.4); opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:9999 }
    #toast.show{ opacity:1 }
    @media (prefers-reduced-motion: reduce){ *{ transition:none!important; animation:none!important } }
    @media (max-width:980px){ .wrap{ grid-template-columns:1fr } aside{ position:static } }
    @media print{ header,aside,.answer-strip,#tagList,#examSummary .stack,footer{ display:none!important } body{ background:#fff; color:#000 } .question-card{ border:0 } }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function(){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); });
    }
  </script>
</head>
<body>
<header>
  <h1>MS2 Mini‚ÄëQBank ‚Äî Structural Congenital Heart Disease</h1>
  <span class="pill">40 items</span>
  <span id="versionPill" class="pill">v1.0</span>
  <span id="timerPill" class="pill hidden" aria-live="polite">‚è± 00:00</span>
  <div class="toolbar">
    <span class="small">Mode:</span>
    <label class="pill"><input type="radio" name="mode" value="practice" checked> Practice</label>
    <label class="pill"><input type="radio" name="mode" value="exam"> Exam (answers at end)</label>
    <button class="btn" id="shuffleBtn" title="Shuffle current set (R)">Shuffle</button>
    <button class="btn" id="reviewWrongBtn" title="Start session with your last incorrect answers">Review mistakes</button>
    <div class="search" role="search">üîé <input id="searchBox" placeholder="Search stem/tags‚Ä¶" aria-label="Search"><button id="clearSearch" class="clear" title="Clear search" aria-label="Clear search">√ó</button></div>
    <button class="btn ghost" id="exportBtn" title="Export progress (JSON)">Export</button>
    <button class="btn ghost" id="importBtn" title="Import progress (JSON)">Import</button>
    <button class="btn ghost" id="resetBtn" title="Clear progress">Reset</button>
    <button class="btn ghost" id="themeBtn" title="Toggle light/dark theme">üåì Theme</button>
  </div>
</header>

<div class="wrap">
  <aside>
    <h2>Filters</h2>
    <div class="group" id="moduleFilters"></div>
    <div class="group"><label><input type="checkbox" id="onlyUnseen"> Only unseen</label><label><input type="checkbox" id="onlyFlagged"> Only flagged</label></div>
    <h2>Tags</h2>
    <div class="chips" id="tagChips"></div>
    <div class="group"><button class="btn good" id="startBtn">Start Session</button><button class="btn" id="prevBtn" title="Previous (‚Üê)">‚Üê Prev</button><button class="btn" id="nextBtn" title="Next (‚Üí)">Next ‚Üí</button></div>
    <div class="group"><h2>Shortcuts</h2><div class="small"><div><span class="kbd">1‚Äì5</span> choose ‚Ä¢ <span class="kbd">Enter</span> submit ‚Ä¢ <span class="kbd">‚Üí</span> next ‚Ä¢ <span class="kbd">F</span> flag ‚Ä¢ <span class="kbd">E</span> explanation ‚Ä¢ <span class="kbd">R</span> shuffle</div></div></div>
    <div class="group"><h2>Your Stats</h2><div class="stat" id="statBar"><div class="kpi"><div class="small">Seen</div><div id="seenCount" style="font-weight:700; font-size:20px">0</div></div><div class="kpi"><div class="small">Accuracy</div><div id="accPct" style="font-weight:700; font-size:20px">‚Äî</div><div class="progress"><div id="accBar" style="width:0%"></div></div></div></div><div id="filterStats" class="small" style="margin-top:8px"></div></div>
  </aside>

  <main>
    <div class="question-card" aria-live="off">
      <div class="question-meta"><div><span id="qCounter" class="small">‚Äî / ‚Äî</span> ¬∑ <span id="qModule" class="small"></span></div><div><button class="flag small" id="flagBtn" aria-pressed="false">‚öë Flag</button></div></div>
      <div id="qStem" class="question-stem"></div>
      <div id="options" class="options" role="radiogroup" aria-label="Answer choices"></div>
      <div class="answer-strip"><button class="btn primary" id="submitBtn">Submit</button><button class="btn" id="showExplainBtn" aria-controls="explain" aria-expanded="false">Show explanation</button><div id="correctness" class="small" aria-live="polite" aria-atomic="true"></div></div>
      <div id="explain" class="explanation"></div>
      <div id="tagList" class="tags"></div>
    </div>

    <section id="examSummary" class="hidden" style="margin-top:16px">
      <div class="question-card">
        <h2>Exam Summary</h2>
        <div id="examStats"></div>
        <div id="breakdown"></div>
        <div style="margin-top:10px" class="stack"><button class="btn good" id="reviewIncorrectBtn">Review incorrect only</button><button class="btn" id="restartBtn">Restart</button></div>
      </div>
    </section>
  </main>
</div>

<footer>
  <p><strong>About.</strong> A portable, single‚Äëfile QBank for MS2 students on structural congenital heart disease. Runs offline in any modern browser. Progress is saved locally (no accounts; no data leaves your device).</p>
  <p class="small">Content is educational, not medical advice. Keyboard: <span class="kbd">1‚Äì5</span>, <span class="kbd">Enter</span>, <span class="kbd">‚Üê/‚Üí</span>, <span class="kbd">F</span>, <span class="kbd">E</span>, <span class="kbd">R</span>.</p>
</footer>

<div id="toast" role="status" aria-live="polite"></div>

<script>
const VERSION = "v1.0"; // bump for each content release
const AUTO_EXPLAIN_WRONG_ONLY = true;

const QUESTIONS = []; // placeholder; you already have the full array live. Keep your current index.html data section.

// ---- The rest of your JS stays as in your deployed version ----
// We only show the version on load:
document.addEventListener("DOMContentLoaded", () => {
  const pill = document.getElementById("versionPill");
  if (pill) pill.textContent = VERSION;
});
</script>
</body>
</html>
